# Telegram 群聊监听系统 - 打包说明

## 概述

本项目支持使用 PyInstaller 打包成可执行文件（EXE）。

## 当前环境

- **操作系统**: macOS (darwin 24.6.0)
- **打包工具**: PyInstaller 6.3.0
- **创建日期**: 2025-10-28 18:09:20
- **作者**: kyle

## 重要提示

### ⚠️ 跨平台打包限制

**PyInstaller 打包限制**: PyInstaller 不支持跨平台打包。也就是说：
- 在 macOS 上打包只能在 macOS 上运行
- 在 Windows 上打包只能在 Windows 上运行
- 在 Linux 上打包只能在 Linux 上运行

### 💡 打包 Windows EXE 的解决方案

如果你需要打包成 Windows 的 EXE 文件，有以下几种方式：

1. **在 Windows 环境下打包**（推荐）
   - 在 Windows 电脑上克隆项目
   - 安装 Python 3.8+
   - 运行打包脚本

2. **使用 GitHub Actions 自动化打包**
   - 设置 CI/CD 自动打包 Windows EXE

3. **使用 Docker 容器模拟 Windows 环境**
   - 在某些情况下可能可以工作，但不保证

## 打包步骤

### 1. 安装依赖

```bash
# 使用 pip 安装
pip install -r requirements.txt

# 或使用 uv（如果已安装）
uv sync
```

### 2. 运行打包脚本

```bash
python build_exe.py
```

### 3. 输出文件

打包成功后，可执行文件位于：
```
dist/TelegramMonitor
```

## 打包配置说明

### 配置文件

- `telegram_monitor.spec` - PyInstaller 配置文件
- `build_exe.py` - 打包辅助脚本

### 包含的内容

打包时会自动包含：
- ✅ 所有 Python 依赖（FastAPI, Telethon 等）
- ✅ HTML 模板文件
- ✅ 配置文件（api_config.json）
- ✅ 所有必需的隐藏导入模块

### 需要单独提供的文件

以下文件不会自动包含，需要手动复制：

1. **telegram_session.session** - Telegram 会话文件（如果有）
2. **环境变量配置** - `.env` 文件（可选）

## 打包后的使用

### Windows 使用方式

```bash
# 直接运行
TelegramMonitor.exe

# 或通过命令行
cd dist
TelegramMonitor.exe
```

### macOS/Linux 使用方式

```bash
# 添加执行权限
chmod +x dist/TelegramMonitor

# 运行
./TelegramMonitor
```

## 常见问题

### Q1: 打包后的文件太大？

**A**: PyInstaller 会将所有依赖打包进去，Telethon 及其依赖比较庞大，这是正常的。可以使用 UPX 压缩。

### Q2: 运行时找不到模块？

**A**: 检查 `telegram_monitor.spec` 中的 `hiddenimports` 列表，添加缺失的模块。

### Q3: 如何添加图标？

**A**: 在 `telegram_monitor.spec` 的 `EXE` 配置中添加：
```python
icon='path/to/icon.ico'  # Windows
icon='path/to/icon.icns'  # macOS
```

### Q4: 如何减小文件大小？

**A**: 
- 使用 UPX 压缩（已启用）
- 考虑使用 Docker 容器部署
- 使用单一目录模式（onefolder）

## 高级配置

### 修改 spec 文件

编辑 `telegram_monitor.spec` 可以：
- 添加额外的数据文件
- 包含或排除特定模块
- 配置启动选项
- 添加图标和版本信息

### 调试打包问题

添加 `--debug` 参数查看详细信息：

```bash
python -m PyInstaller --debug=all telegram_monitor.spec
```

## 部署建议

### 开发环境
使用 Python 直接运行更方便调试：

```bash
python main.py
```

### 生产环境
使用打包后的可执行文件，优点：
- ✅ 无需安装 Python
- ✅ 包含所有依赖
- ✅ 一键运行

## 许可证

MIT License

## 联系

如有问题，请联系作者：kyle (zhongyuchuan@joyme.sg)


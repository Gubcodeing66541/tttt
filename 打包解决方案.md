# 在 macOS 上打包 Windows EXE 的解决方案

## 问题说明

PyInstaller 不支持跨平台打包，也就是说：
- ✅ 在 Windows 上打包 → 生成 Windows EXE
- ✅ 在 macOS 上打包 → 生成 macOS 可执行文件
- ❌ 在 macOS 上无法打包生成 Windows EXE

## 解决方案

### 方案一：使用 GitHub Actions 自动化打包（推荐）⭐

这是最简单、最可靠的方法。GitHub Actions 可以在云端的 Windows 环境中自动打包。

#### 1. 创建 GitHub Actions 工作流

创建文件 `.github/workflows/build-windows.yml`：

```yaml
name: Build Windows EXE

on:
  push:
    tags:
      - 'v*'
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
    
    - name: Build executable
      run: |
        python build_exe.py
    
    - name: Upload artifact
      uses: actions/upload-artifact@v3
      with:
        name: TelegramMonitor-Windows
        path: dist/TelegramMonitor.exe
```

#### 2. 使用方法

```bash
# 创建 tag 触发构建
git tag v1.0.0
git push origin v1.0.0

# 或手动触发
# 在 GitHub 网页上点击 Actions -> Build Windows EXE -> Run workflow
```

### 方案二：使用 Docker 跨平台打包

使用 `pyinstaller/pyinstaller` Docker 镜像。

#### 1. 创建 Dockerfile

```dockerfile
# 用于打包 Windows EXE
FROM pyinstaller/pyinstaller-windows:latest

WORKDIR /work

# 复制项目文件
COPY . .

# 安装依赖
RUN pip install -r requirements.txt

# 打包
RUN pyinstaller telegram_monitor.spec

# 输出文件在 dist/ 目录
```

#### 2. 运行命令

```bash
# 构建镜像
docker build -t telegram-monitor-builder .

# 运行打包（生成 Windows EXE）
docker run --rm -v $(pwd)/dist:/work/dist telegram-monitor-builder

# 结果在 dist/ 目录
```

### 方案三：使用 WINE + PyInstaller（复杂）

在 macOS 上使用 WINE 模拟 Windows 环境，然后在其中运行 Windows 版本的 PyInstaller。

#### 1. 安装 WINE

```bash
# 使用 Homebrew 安装
brew install --cask wine-stable
```

#### 2. 下载 Windows 版本的 PyInstaller

```bash
# 下载 PyInstaller Windows 版本
wget https://github.com/pyinstaller/pyinstaller/releases/download/v6.3.0/PyInstaller-6.3.0.zip
unzip PyInstaller-6.3.0.zip
```

#### 3. 使用 WINE 运行

```bash
# 注意：这个方法可能不稳定，不推荐
wine python.exe PyInstaller/__main__.py telegram_monitor.spec
```

### 方案四：在 Windows 虚拟机上打包（最可靠）

使用 Parallels Desktop 或 VMware Fusion 在 macOS 上运行 Windows 虚拟机，然后在虚拟机中打包。

#### 步骤：

1. 在虚拟机中安装 Windows
2. 在 Windows 中安装 Python 3.8+
3. 克隆项目到虚拟机
4. 运行打包脚本

### 方案五：云开发环境

使用 GitHub Codespaces、GitPod 或 CodeSandbox 等云开发环境，选择 Windows 镜像。

## 推荐流程

### 最简单的方法

1. **提交代码到 GitHub**
2. **添加 GitHub Actions 工作流**（方案一）
3. **创建 Release Tag**
4. **下载自动打包的 EXE 文件**

### 代码示例

我已经为你准备好了 GitHub Actions 配置文件。你只需要：

```bash
# 创建 GitHub Actions 目录
mkdir -p .github/workflows

# 使用我创建的工作流文件
```

## 快速测试

### 在 macOS 上测试打包 macOS 版本

```bash
# 安装 PyInstaller
pip install pyinstaller

# 打包
python build_exe.py

# 运行
./dist/TelegramMonitor
```

这虽然不能生成 EXE，但可以验证打包配置是否正确。

## 总结

| 方案 | 难度 | 可靠性 | 推荐度 |
|------|------|--------|--------|
| GitHub Actions | ⭐⭐ | 很高 | ⭐⭐⭐⭐⭐ |
| Docker | ⭐⭐⭐ | 高 | ⭐⭐⭐⭐ |
| WINE | ⭐⭐⭐⭐⭐ | 低 | ⭐ |
| 虚拟机 | ⭐⭐⭐ | 很高 | ⭐⭐⭐ |
| 云环境 | ⭐⭐ | 高 | ⭐⭐⭐ |

**强烈推荐使用 GitHub Actions 方案**，它最简单且最可靠。


# 在 macOS 上打包 Windows EXE 的简单方法

## 方案选择

你的情况：在 macOS 上开发，但需要打包成 Windows EXE

## 最简单的方法：使用在线服务

### 方法一：GitHub Actions（推荐）⭐

这是最容易、最可靠的方法。

#### 步骤：

1. **提交代码到 GitHub**
```bash
git add .
git commit -m "Add PyInstaller build configuration"
git push origin main
```

2. **创建 Release Tag**
```bash
git tag v1.0.0
git push origin v1.0.0
```

3. **自动打包**
- GitHub Actions 会自动在云端 Windows 环境中打包
- 等待几分钟
- 在 GitHub Releases 页面下载 EXE 文件

4. **下载 EXE**
- 访问 https://github.com/你的用户名/tg/releases
- 下载 `TelegramMonitor.exe`

### 方法二：本地虚拟机打包

#### 需要：
- Parallels Desktop 或 VMware Fusion
- Windows 10/11 ISO 镜像

#### 步骤：

1. **安装虚拟机**
   - 购买并安装 Parallels Desktop（约 $99）
   - 或使用免费的 VMware Fusion Player

2. **安装 Windows**
   - 在虚拟机中安装 Windows 10/11
   - 下载地址：https://www.microsoft.com/software-download/windows10

3. **在 Windows 中打包**
```bash
# 克隆项目
git clone 你的仓库地址
cd tg

# 安装 Python
# 从 python.org 下载并安装 Python 3.11

# 安装依赖
pip install -r requirements.txt

# 打包
python build_exe.py

# 生成的 EXE 在 dist/TelegramMonitor.exe
```

## 当前可以在 macOS 上做的事项

### 测试打包配置

你可以先打包 macOS 版本，验证配置是否正确：

```bash
# 安装依赖
uv sync

# 打包
python build_exe.py

# 运行测试
./dist/TelegramMonitor
```

### 验证配置

打包前可以先验证：
- ✅ PyInstaller spec 配置
- ✅ 依赖是否正确
- ✅ 打包脚本是否可用

## 快速开始指南

### 如果现在就想打包

**选项 A：立即使用（需要并行环境）**
```bash
# 使用在线 Windows 虚拟机
# https://www.easypc.io/
# 或 https://www.online.net/en/dedicated-server/dedibox-XC
```

**选项 B：等几分钟（推荐）**
```bash
# 1. 提交到 GitHub
git add .
git commit -m "Ready for Windows build"
git push origin main

# 2. 创建 tag
git tag v1.0.0
git push origin v1.0.0

# 3. 等待 GitHub Actions 自动打包
# 4. 下载 EXE 文件
```

**选项 C：用 Docker（如果熟悉）**
```bash
docker build -f Dockerfile.windows -t telegram-builder .
docker run --rm -v $(pwd)/dist:/work/dist telegram-builder
# 可能需要额外的 WINE 配置
```

## 推荐流程

1. ✅ **今天就做**：测试 macOS 打包配置
2. ✅ **今天就做**：提交代码到 GitHub  
3. ✅ **今天就做**：创建 GitHub Actions 配置
4. ⏭️ **明天做**：创建 tag 触发 Windows 打包
5. ⏭️ **明天做**：下载 EXE 文件

## 打包后的使用

### Windows EXE 使用方法

```bash
# 直接运行
TelegramMonitor.exe

# 或通过命令行
cd 解压目录
TelegramMonitor.exe
```

### 需要的文件

打包后需要包含的文件：
- `TelegramMonitor.exe` - 主程序
- `api_config.json` - 配置文件（可选，会询问用户输入）
- `telegram_session.session` - 会话文件（首次运行后自动生成）

## 常见问题

**Q: 为什么不能直接在 macOS 上打包 EXE？**
A: PyInstaller 使用编译后的二进制文件，需要目标平台的环境。

**Q: 哪种方法最可靠？**
A: GitHub Actions，因为它使用官方的 Windows 环境。

**Q: 需要多长时间？**
A: GitHub Actions 大约需要 5-10 分钟。

**Q: 可以自动化吗？**
A: 已经自动化了！只需要创建 tag 就会自动打包。

## 现在可以做什么

### 1. 测试 macOS 打包
```bash
uv sync
python build_exe.py
./dist/TelegramMonitor
```

### 2. 提交到 GitHub
```bash
git add .
git commit -m "Add build configuration"
git push origin main
```

### 3. 创建 tag 触发 Windows 打包
```bash
git tag v1.0.0
git push origin v1.0.0
```

## 联系

如有问题，请查看：
- 打包说明.md - 详细说明
- 打包解决方案.md - 所有方案对比

